/**
 * Password Meter Override - Fix Overlap with Toggle Button
 *
 * Issue: Odoo's auth_password_policy_portal positions the password meter
 * absolutely inside the input field (right: 5px), conflicting with our
 * password toggle button (right: 0px).
 *
 * Solution: Move meter below the input field (static positioning).
 *
 * UX Pattern: Follows Google, Microsoft, GitHub standards for password
 * strength indicators.
 *
 * Files modified:
 * - This file (new)
 * - __manifest__.py (add to assets)
 *
 * Odoo Core Files Overridden:
 * - auth_password_policy_portal/static/src/scss/portal_policy.scss
 * - auth_password_policy/static/src/css/password_field.css
 *
 * Related: Password toggle feature implementation
 * Testing: E2E tests in tests/e2e/password-toggle.spec.js
 */

// Override Odoo core meter positioning for portal security page
.o_portal_security_body #new-password-group {
  // Remove absolute positioning from meter
  // NOTE: This override targets Odoo v17 core styles (see portal_policy.scss, password_field.css)
  meter.o_password_meter {
    position: static !important;  // Override Odoo's absolute positioning
    display: block;
    width: 100%;
    height: 6px;  // Thinner bar (modern design, was 15px in core)
    margin-top: 8px;  // Space below input field
    margin-bottom: 4px;  // Space before next element
    right: auto !important;  // Reset core right: 5px
    bottom: auto !important;  // Reset core bottom: calc(50% - 7px)

    // Ensure meter is visible even with empty input
    // (Override core: input.o_field_password:placeholder-shown + meter { display: none; })
    display: block !important;
  }

  // CRITICAL FIX: Position toggle button INSIDE the input field (vertically centered)
  // The parent container (#new-password-group) has 14px padding-bottom between input and container edge.
  // To center the 41px button inside the 34px input:
  //   - Input center Y = input_top + 17px
  //   - Button center Y = input center Y (for perfect centering)
  //   - bottom = container_padding(14px) - (button_height - input_height)/2 = 14 - 3.5 = 10.5px
  .password-toggle-btn {
    bottom: 11px !important; // 10.5px rounded - centers 41px button in 34px input

    // IMPORTANT: Restore button sizing (page-specific ID selector overrides mobile CSS)
    // Without this, mobile button shows as 16px instead of 44px
    width: 41px !important;
    height: 41px !important;
    min-width: 41px !important;
    min-height: 41px !important;
  }

  // Adjust input padding: Only account for toggle button (right side)
  // Meter is now below, so no left/right padding adjustment needed
  input[name="new1"] {
    padding-right: 41px !important;  // Space for toggle button (desktop: 41px full-height button)
  }
}

// Mobile viewport adjustments for /my/security page
@media (max-width: 768px) {
  .o_portal_security_body #new-password-group {
    .password-toggle-btn {
      // Mobile button size (WCAG minimum 44x44px)
      width: 44px !important;
      height: 44px !important;
      min-width: 44px !important;
      min-height: 44px !important;

      // Adjust bottom offset for larger button (44px vs 41px)
      // bottom = container_padding(14px) - (44 - 34)/2 = 14 - 5 = 9px
      bottom: 9px !important; // Centers 44px button in 34px input on mobile
    }

    input[name="new1"] {
      padding-right: 44px !important; // Mobile: 44px button width
    }
  }
}

// Style meter colors to match Destock Info branding and Bootstrap
meter.o_password_meter {
  // WebKit browsers (Chrome, Safari, Edge)
  &::-webkit-meter-bar {
    background-color: #e9ecef;  // Bootstrap gray-200
    border-radius: 3px;
  }

  &::-webkit-meter-optimum-value {
    background-color: #28a745;  // Bootstrap success (strong password)
  }

  &::-webkit-meter-suboptimum-value {
    background-color: #ffc107;  // Bootstrap warning (medium password)
  }

  &::-webkit-meter-even-less-good-value {
    background-color: #dc3545;  // Bootstrap danger (weak password)
  }

  // Firefox meter styling
  &::-moz-meter-bar {
    border-radius: 3px;
  }
}

// High contrast mode support for accessibility
@media (prefers-contrast: high) {
  meter.o_password_meter {
    border: 2px solid #000;
  }
}

// Responsive adjustments for mobile
@media (max-width: 768px) {
  .o_portal_security_body #new-password-group {
    meter.o_password_meter {
      height: 8px;  // Slightly taller on mobile (easier to see)
      margin-top: 10px;  // More space on mobile
    }
  }
}

// Reduced motion support for accessibility
@media (prefers-reduced-motion: reduce) {
  meter.o_password_meter {
    transition: none !important;
  }
}

// ============================================================================
// SIGNUP PAGE (/web/signup)
// ============================================================================

// Override meter positioning for signup page
.oe_signup_form, .oe_reset_password_form {
  // Target password field container
  .field-password {
    position: relative;

    // Move meter below the input field
    meter.o_password_meter {
      position: static !important;  // Override Odoo's absolute positioning
      display: block;
      width: 100%;
      height: 6px;  // Thinner bar (modern design)
      margin-top: 8px;  // Space below input field
      margin-bottom: 4px;  // Space before next element
      right: auto !important;  // Reset core right: 5px
      bottom: auto !important;  // Reset core bottom
      display: block !important;  // Always visible
    }

    // Position toggle button inside the input field (vertically centered)
    .password-toggle-btn {
      bottom: 11px !important; // Centers button in input
      width: 41px !important;
      height: 41px !important;
      min-width: 41px !important;
      min-height: 41px !important;
    }

    // Adjust input padding for toggle button (right side only, meter is below)
    input[name="password"] {
      padding-right: 41px !important;
    }
  }
}

// Mobile adjustments for signup page
@media (max-width: 768px) {
  .oe_signup_form, .oe_reset_password_form {
    .field-password {
      .password-toggle-btn {
        width: 44px !important;
        height: 44px !important;
        min-width: 44px !important;
        min-height: 44px !important;
        bottom: 9px !important; // Centers 44px button in input on mobile
      }

      input[name="password"] {
        padding-right: 44px !important; // Mobile button width
      }

      meter.o_password_meter {
        height: 8px;  // Slightly taller on mobile
        margin-top: 10px;
      }
    }
  }
}
