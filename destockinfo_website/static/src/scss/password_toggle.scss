/**
 * Password Toggle Button - SCSS Styles
 *
 * Styles for password visibility toggle button on authentication forms.
 * Uses BEM naming convention and Bootstrap 5 utilities.
 *
 * Features:
 * - Position absolute inside password field (parent needs position-relative)
 * - 44x44px touch target (Apple HIG recommendation, exceeds WCAG 24x24px minimum)
 * - 4.5:1 color contrast (WCAG AA compliance)
 * - Responsive adjustments for mobile devices
 * - High contrast mode support
 * - Keyboard focus outline
 *
 * Constitution compliance:
 * - Principle IV: BEM naming (.password-toggle-btn, .password-toggle-btn__icon)
 * - Principle XII: WCAG 2.1 Level AA accessibility
 */

// Password toggle button (block)
.password-toggle-btn {
  // CRITICAL: Reset ALL browser defaults and Bootstrap inheritance
  // This eliminates conflicts from removed .btn .btn-link classes
  all: unset;

  // Re-declare all necessary properties after reset
  position: absolute;
  top: auto; // Don't use top positioning
  bottom: 0; // Anchor to bottom of container
  right: 0px; // 0px from right edge - completely flush to border
  z-index: 100; // High z-index to ensure button stays above input during :active state

  // Desktop touch target size (41x41px - matches input height)
  width: 41px;
  height: 41px; // Explicit height to match input
  min-width: 41px; // Prevent shrinking
  min-height: 41px;

  // Remove default button styles
  background: transparent;
  border: none;
  padding: 0;

  // Flexbox for icon centering
  display: flex;
  align-items: center;
  justify-content: center;

  // Cursor and user interaction
  cursor: pointer;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;

  // Prevent layout shift on click
  box-sizing: border-box;

  // Smooth transitions
  transition: background-color 150ms ease-in-out;

  // Hover state (desktop)
  &:hover {
    background-color: rgba(0, 0, 0, 0.05);
    border-radius: 4px;
  }

  // Focus state (keyboard navigation)
  &:focus {
    outline: 2px solid #007bff; // Bootstrap primary color
    outline-offset: 2px;
    border-radius: 4px;
  }

  // Active/pressed state (no layout shift)
  &:active {
    background-color: rgba(0, 0, 0, 0.1);
    // No transform needed - button stays in place (anchored with bottom: 0)
  }

  // Icon element (BEM element naming)
  &__icon {
    font-size: 16px;
    color: #6c757d; // Bootstrap $o-gray-600 equivalent (4.5:1 contrast on white)
    pointer-events: none; // Prevent icon from blocking button clicks

    // Ensure icon doesn't shrink
    flex-shrink: 0;
  }
}

// Password input field adjustment (add padding to prevent text overlap)
// Target inputs inside .position-relative containers (added by our templates)
// This works in ALL browsers (no :has() needed, Firefox compatible)
.position-relative {
  input[type="password"],
  input[type="text"][name="password"],
  input[type="text"][name="confirm_password"],
  input[type="text"][name="old"],
  input[type="text"][name="new1"],
  input[type="text"][name="new2"] {
    padding-right: 41px !important; // Desktop: 41px full-height button - !important to override Bootstrap .px-3
  }
}

// Responsive adjustments for mobile devices
@media (max-width: 768px) {
  .password-toggle-btn {
    // Larger touch target on mobile (44x44px - WCAG minimum)
    width: 44px;
    height: 44px; // Explicit height for WCAG touch target
    min-width: 44px;
    min-height: 44px;

    &__icon {
      font-size: 18px; // Slightly larger icon on mobile
    }
  }

  // Adjust input padding for mobile button size
  .position-relative {
    input[type="password"],
    input[type="text"][name="password"],
    input[type="text"][name="confirm_password"],
    input[type="text"][name="old"],
    input[type="text"][name="new1"],
    input[type="text"][name="new2"] {
      padding-right: 44px !important; // Mobile: 44px button width
    }
  }
}

// High contrast mode support (accessibility)
@media (prefers-contrast: high) {
  .password-toggle-btn {
    &:hover {
      background-color: rgba(0, 0, 0, 0.15);
    }

    &__icon {
      color: #000; // Higher contrast in high contrast mode
    }

    &:focus {
      outline-width: 3px; // Thicker outline for high contrast
    }
  }
}

// RTL (Right-to-Left) support (for future i18n)
html[dir="rtl"] {
  .password-toggle-btn {
    right: auto;
    left: 0px; // 0px from left edge (RTL mode) - completely flush - consistent with LTR
  }

  .position-relative {
    input[type="password"],
    input[type="text"][name="password"],
    input[type="text"][name="confirm_password"],
    input[type="text"][name="old"],
    input[type="text"][name="new1"],
    input[type="text"][name="new2"] {
      padding-right: 12px; // Reset right padding
      padding-left: 34px !important; // Desktop: 34px button width (RTL mode)
    }
  }

  // RTL mobile adjustments
  @media (max-width: 768px) {
    .position-relative {
      input[type="password"],
      input[type="text"][name="password"],
      input[type="text"][name="confirm_password"],
      input[type="text"][name="old"],
      input[type="text"][name="new1"],
      input[type="text"][name="new2"] {
        padding-left: 44px !important; // Mobile: 44px button width (RTL mode)
      }
    }
  }
}
